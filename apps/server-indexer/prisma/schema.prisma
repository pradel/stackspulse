generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client-generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Block {
  height       BigInt        @id @map("height")
  timestamp    Int           @map("timestamp")
  transactions Transaction[] @relation("BlockTransactions")
}

model Transaction {
  id          String @id @map("id")
  blockHeight BigInt @map("block_height")
  block       Block  @relation("BlockTransactions", fields: [blockHeight], references: [height])
}

model Token {
  // token address
  id            String @id @map("id")
  // token symbol
  symbol        String @map("symbol")
  // token name
  name          String @map("name")
  // token decimals
  decimals      Int    @map("decimals")
  // transactions across all pools that include this token
  txCount       BigInt @map("tx_count")
  // number of pools containing this token
  poolCount     Int    @map("pool_count")
  // pools where this token is token0
  poolsAsToken0 Pool[] @relation("PoolToken0")
  // pools where this token is token1
  poolsAsToken1 Pool[] @relation("PoolToken1")
  // pools where this token is token0
  swapsAsToken0 Swap[] @relation("SwapToken0")
  // pools where this token is token1
  swapsAsToken1 Swap[] @relation("SwapToken1")
}

model Pool {
  id       String @id @map("id")
  // first token in the pool
  token0Id String @map("token0_id")
  token0   Token  @relation("PoolToken0", fields: [token0Id], references: [id])
  // second token in the pool
  token1Id String @map("token1_id")
  token1   Token  @relation("PoolToken1", fields: [token1Id], references: [id])
  // all time number of transactions
  txCount  BigInt @map("tx_count")
  swaps    Swap[]
}

model Swap {
  // transaction hash + "-" + index in swaps Transaction array
  id       String @id @map("id")
  // pool swap occured within
  poolId   String @map("pool_id")
  pool     Pool   @relation(fields: [poolId], references: [id])
  // token swapped in
  token0Id String @map("token0_id")
  token0   Token  @relation("SwapToken0", fields: [token0Id], references: [id])
  // token swapped out
  token1Id String @map("token1_id")
  token1   Token  @relation("SwapToken1", fields: [token1Id], references: [id])
  // sender of the swap
  sender   String @map("sender")
  // delta of token0
  amount0  BigInt @map("amount0")
  // delta of token1
  amount1  BigInt @map("amount1")
  // index within the txn
  txIndex  Int    @map("tx_index")
}
